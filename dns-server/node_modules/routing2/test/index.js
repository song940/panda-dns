const assert = require('assert');
const test = require('./test');
const { parse, pathToRegexp } = require('..');

var r;

test('normal path', () => {
  r = pathToRegexp('/normal/path');
  assert.ok(r.parse('/normal/path'));
  assert.equal(r.parse('/aaa'), null);
});

test('optional parameter', () => {
  r = pathToRegexp('/v1/:name*');
  assert.deepEqual(r.parse('/v1/aaa/bbb'), { name: 'aaa/bbb'})
});

test('named key and optional parameter', () => {
  r = pathToRegexp('/:a/:b*');
  s = '/test/';
  assert.ok(r.test(s));
  assert.deepEqual(r.parse(s), { a: 'test', b: '' });
});

test('parse routing rules', () => {
  const routes = parse(`
  get / => home#index
  get /:name => home#user
  `);
  assert.equal(routes[0].path, '/');
  assert.equal(routes[0].action, 'index');
  assert.equal(routes[1].action, 'user');
  assert.equal(routes[1].controller, 'home');
});